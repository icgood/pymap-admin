syntax = "proto3";

package admin;

message PingRequest {
  string client_version = 1;
}

message PingResponse {
  string server_version = 1;
}

enum ResultCode {
  SUCCESS = 0;
  FAILURE = 1;
}

message Result {
  ResultCode code = 1;
  bytes response = 2;
  string key = 3;
}

message Login {
  string user = 1;
}

message AppendRequest {
  Login login = 1;
  string sender = 2;
  string recipient = 3;
  string mailbox = 4;
  bytes data = 5;
  repeated string flags = 6;
  uint64 when = 7;
}

message AppendResponse {
  Result result = 1;
  string mailbox = 2;
  uint32 validity = 3;
  uint32 uid = 4;
}

message UserData {
  string password = 1;
  map<string, string> params = 5;
}

message UserResponse {
  Result result = 1;
  string username = 2;
  UserData data = 3;
}

message ListUsersRequest {
  string match = 1;
}

message GetUserRequest {
  string username = 1;
}

message SetUserRequest {
  string username = 1;
  UserData data = 2;
}

message DeleteUserRequest {
  string username = 1;
}

service Admin {
  rpc Ping (PingRequest) returns (PingResponse) {}
  rpc Append (AppendRequest) returns (AppendResponse) {}
  rpc ListUsers (ListUsersRequest) returns (stream UserResponse) {}
  rpc GetUser (stream GetUserRequest) returns (stream UserResponse) {}
  rpc SetUser (stream SetUserRequest) returns (stream UserResponse) {}
  rpc DeleteUser (stream DeleteUserRequest) returns (stream UserResponse) {}
}
